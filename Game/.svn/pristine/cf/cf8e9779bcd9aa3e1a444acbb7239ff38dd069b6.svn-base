#include "Enemy.h"
Enemy::Enemy()
	: alive(true), state(0), moveSpeed(200)
{
	for (int i(0); i < this->getVertexCount(); ++i)
		this->setVertexColour(i, sf::Color::Green);
	setOrigin(0, 0);
	
	collider_.width = 60;
	collider_.height = 60;
	collider_.left = getPosition().x;
	collider_.top = getPosition().y;

	chaseBox_.width = 512;
	chaseBox_.height = 512;
	chaseBox_.left = getPosition().x - (getGlobalBounds().width * 2);
	chaseBox_.top = getPosition().y - (getGlobalBounds().width * 2);

	
	
}

void Enemy::update(const sf::Time& delta, const sf::Vector2f& playerPos)
{
	collider_.left = getPosition().x;
	collider_.top = getPosition().y;

	chaseBox_.left = getPosition().x - (getGlobalBounds().width * 2);
	chaseBox_.top = getPosition().y - (getGlobalBounds().height * 2);

	if (state == 1 && alive)
	{
		chase(delta, playerPos);
	}


	//std::cout << collider_.left << " - " << collider_.top << std::endl;
	//1216 - 6912
}

void Enemy::chase(const sf::Time& delta, const sf::Vector2f& playerPos)
{
	sf::Vector2f direction(0, 0);
	sf::Vector2f movement(0, 0);
	sf::Vector2f pos(getPosition().x + getGlobalBounds().width / 2, getPosition().y + getGlobalBounds().height / 2);

	if (playerPos.x - pos.x < 0)
	{
		direction.x = -1;
	}
	if (playerPos.x - pos.x > 0)
	{
		direction.x = 1;
	}
	if (playerPos.y - pos.y < 0)
	{
		direction.y = -1;
	}
	if (playerPos.y - pos.y > 0)
	{
		direction.y = 1;
	}

	//create a vector that uses the two colliders and the direction to work out collisions
	sf::Vector2f a(direction.x * (delta.asSeconds() * moveSpeed), direction.y * (delta.asSeconds() * moveSpeed));


	movement = (p_tileMap_->getCollisionVector(collider_, a));

	if (movement.x != 0 && movement.y != 0) //if the movement vector is not (0,0)
	{
		sf::Vector2f normalized(normalize(movement));
		movement.x *= fabs(normalized.x);
		movement.y *= fabs(normalized.y);
	}

	move(movement);	//move the enemy
}
